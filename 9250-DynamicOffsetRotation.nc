%
O9250 (DYNAMIC ROTATION CALC)
(AUTHOR PAUL SITES)
(DATE 2024.04.10)
(PURPOSE ROTATE ABOUT A SPECIFIED AXIS GIVEN AN INITIAL)
(WORK OFFSET AND ROTATION AMOUNT IN DEGREES FROM AN ORIGIN)
(OF ROTATION) 

(A 1 = ROTATION AXIS X 1, Y 2, Z 3)
(B 2 = ROTATION AXIS PARAMETER ID OPTIONAL)
(C 3 = C_ROT OFFSET OPTIONAL)
(I 4 = INITIAL OFFSET)
(S 19 = RESULT OFFSET)
(R 18 = ROTATION FROM INITIAL IN DEG)
IF [#1 EQ #0] THEN #3000=1(NEED ROTATION AXIS)
IF [#4 EQ #0] THEN #3000=1(NEED INITIAL OFFSET)
IF [#19 EQ #0] THEN #3000=1(NEED DESTINATION OFFSET)
IF [#18 EQ #0] THEN #3000=1(NEED ROTATION ANGLE)

#101 = 0 (CENTER OF ROTATION X)
#102 = 0 (CENTER OF ROTATION Y)
#103 = 0 (CENTER OF ROTATION Z)
#104 = 0 (INITIAL WORK OFFSET X)
#105 = 0 (INITIAL WORK OFFSET Y)
#106 = 0 (INITIAL WORK OFFSET Z)
#107 = 0 (INITIAL WORK OFFSET THETA)
#108 = #1 (ROTATION AXIS A)
#116 = 4 (ROTATION AXIS PARAMETER ID DEFAULT 4)

N40 (SET AXIS PARAMETER ID)
( BY DEFAULT ASSUMES THE #5204 SYSTEM VARIABLE SCHEME)
( SOME MACHINES USE A DIFFERENT AXIS ID EX #5205)
( THIS FUNCTION WILL ALLOW THE USER TO SPECIFY THE)
( AXIS ID FOR THE ROTATION AXIS)
IF [#2 EQ #0] GOTO49
#116 = #2
N49

N50 (SET CENTER OF ROTATION BASED ON C)
( THE CENTER OF ROTATION CAN BE HARDCODED FOR EACH MACHINE)
( OR CAN BE PASSED AS A PARAMETER IN THE FORM OF A WORK)
( OFFSET THAT IS STORING THE CENTER OF ROTATION)
IF [#3 EQ #0] GOTO52
#140=51
#146=#3
GOTO900
N51
#101 = #[#141]
#102 = #[#142]
#103 = #[#143]
N52 (CHECK FOR ZERO CENTER OF ROTATION)
IF [#101 EQ #0] GOTO53
IF [#102 EQ #0] GOTO53
IF [#103 EQ #0] GOTO53
GOTO59
N53
#3000=1(CENT ROT CANNOT BE ZERO)
N59

N60 (SET INITIAL WORK OFFSET BASED ON I)
( THE INITIAL WORK OFFSET IS THE WORK OFFSET THAT)
( THE ROTATION IS TO BE APPLIED TO RESULT WILL BE)
( STORED IN THE DESTINATION OFFSET)
#140=61
#146=#4
GOTO900
N61
#104 = #[#141]
#105 = #[#142]
#106 = #[#143]
#107 = #[#144]

N70 (ROTATION CALCULATIONS)
IF [#108 EQ 1] GOTO 100
IF [#108 EQ 2] GOTO 200
IF [#108 EQ 3] GOTO 300
GOTO 999

N100 (ROTATION ABOUT X-AXIS)
#109 = [#18 * [1.0]] 
(ROTATION ANGLE IN DEGREES R)

#110 = #105 - #102 (RELATIVE Y)
#111 = #106 - #103 (RELATIVE Z)
#112 = #104 (X REMAINS UNCHANGED)
#113 = #110 * [FIX[COS[#109]*1000.0]/1000.0] - #111 * [FIX[SIN[#109]*1000.0]/1000.0] + #102 (NEW Y)
#114 = #110 * [FIX[SIN[#109]*1000.0]/1000.0] + #111 * [FIX[COS[#109]*1000.0]/1000.0] + #103 (NEW Z)
#115 = #107 (COPY ROTATION OFFSET)
GOTO 400

N200 (ROTATION ABOUT Y-AXIS)
#109 = [#18 * [-1.0]] 
(ROTATION ANGLE IN DEGREES R)

#110 = #104 - #101 (RELATIVE X)
#111 = #106 - #103 (RELATIVE Z)
#112 = #110 * [FIX[COS[#109]*1000.0]/1000.0] + #111 * [FIX[SIN[#109]*1000.0]/1000.0] + #101 (NEW X)
#113 = #105 (Y REMAINS UNCHANGED)
#114 = -#110 * [FIX[SIN[#109]*1000.0]/1000.0] + #111 * [FIX[COS[#109]*1000.0]/1000.0] + #103 (NEW Z)
#115 = #107 (COPY ROTATION OFFSET)
GOTO 400

N300 (ROTATION ABOUT Z-AXIS)
#109 = [#18 * [1.0]] 
(ROTATION ANGLE IN DEGREES R)

#110 = #104 - #101 (RELATIVE X)
#111 = #105 - #102 (RELATIVE Y)
#112 = #110 * [FIX[COS[#109]*1000.0]/1000.0] - #111 * [FIX[SIN[#109]*1000.0]/1000.0] + #101 (NEW X)
#113 = #110 * [FIX[SIN[#109]*1000.0]/1000.0] + #111 * [FIX[COS[#109]*1000.0]/1000.0] + #102 (NEW Y)
#114 = #106 (Z REMAINS UNCHANGED)
#115 = #107 (COPY ROTATAION OFFSET)

N400 (SAVE RESULT TO OFFSET)
(SET INITIAL WORK OFFSET BASED ON I)
#140=700
#146=#19
GOTO900
N700
#[#141] = #112
#[#142] = #113
#[#143] = #114
#[#144] = #115

(SKIP OVER SUPPORT FUNCTIONS)
GOTO999

N900 (CONVERT OFFSET)
IF [#146 GT 100] GOTO 902
IF [#146 LT 7] GOTO 901
#146 = #146 - 53.
N901
IF [#146 LT 1] THEN #3000=1(ILLEGAL OFFSET)
IF [#146 GT 6] THEN #3000=1(ILLEGAL OFFSET)
#141 = [#146 * 20 + 5201]
#142 = [#146 * 20 + 5202]
#143 = [#146 * 20 + 5203]
#144 = [#146 * 20 + 5200 + #116]
GOTO 910
N902
#146 = #146 - 100.
IF [#146 LT 1.] THEN #3000=1(ILLEGAL OFFSET)
IF [#146 GT 48.] THEN #3000=1(ILLEGAL OFFSET)
#141 = [#146 * 20 + 6981]
#142 = [#146 * 20 + 6982]
#143 = [#146 * 20 + 6983]
#144 = [#146 * 20 + 6980 + #116]
N910
GOTO#140

N999
M99
%